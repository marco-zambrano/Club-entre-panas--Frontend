<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Control</title>
    <script>
        // Detectar el entorno
        const isProduction = window.location.hostname !== "localhost";

        // Definir la configuración para cada entorno
        const config = {
            basePath: isProduction
            ? "/ruta/secreta/secretisima/dashboard"
            : "",
            pathSocket: isProduction
            ? "/ruta/secreta/secretisima"
            : "",
            socketConfig: {
            url: isProduction ? "https://panasresponde.work" : undefined,
            options: isProduction
                ? { path: "/ruta/secreta/secretisima/socket.io" }
                : {},
            },
        };

        // Hacer la configuración accesible globalmente para otros scripts
        window.APP_CONFIG = config;

        // Escribir las etiquetas con las rutas correctas ANTES de que la página cargue
        document.write(`
            <link rel="stylesheet" href="${config.basePath}/style.css" />
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
            <link rel="icon" type="image/png" href="${config.basePath}/favicon-96x96.png" sizes="96x96" />
            <link rel="icon" type="image/svg+xml" href="${config.basePath}/favicon.svg" />
            <link rel="shortcut icon" href="${config.basePath}/favicon.ico" />
            <link rel="apple-touch-icon" sizes="180x180" href="${config.basePath}/apple-touch-icon.png" />
            <link rel="manifest" href="${config.basePath}/site.webmanifest" />
        `);
    </script>
</head>
<body>
    <div class="chat-container">
        <!-- Filtros superiores -->
        <div class="filters">
            <div class="filter-groups">
                <div class="platform-filters">
                    <div class="filter">
                        <span>Facebook</span>
                        <label class="toggle">
                            <input type="checkbox" checked class="platform-toggle" data-platform="facebook">
                            <span class="slider facebook-slider"></span>
                        </label>
                    </div>
                    <div class="filter">
                        <span>Instagram</span>
                        <label class="toggle">
                            <input type="checkbox" checked class="platform-toggle" data-platform="instagram">
                            <span class="slider instagram-slider"></span>
                        </label>
                    </div>
                    <div class="filter" id="whatsapp-toggle">
                        <span>WhatsApp</span>
                        <label class="toggle">
                            <input type="checkbox" checked class="platform-toggle" data-platform="whatsapp">
                            <span class="slider whatsapp-slider"></span>
                        </label>
                    </div>
                    <div class="item-filter">
                        <button class="item-chat">Chats</button>
                        <button class="item-comment">Comentarios</button>
                        <button class="unread-filter-btn">No leídos</button>
                    </div>
                </div>
                <span class="toggle-tag-filters-btn">Mostrar filtros de etiquetas >></span>
                <div class="tag-filters">
                    <div class="filter">
                        <span>Todos</span>
                        <label class="toggle">
                            <input type="radio" name="tag-filter" checked class="tag-toggle" data-tag="all">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="filter">
                        <span>Contraentrega</span>
                        <label class="toggle">
                            <input type="radio" name="tag-filter" class="tag-toggle" data-tag="Contraentrega">
                            <span class="slider contraentrega-slider"></span>
                        </label>
                    </div>
                    <div class="filter">
                        <span>RP</span>
                        <label class="toggle">
                            <input type="radio" name="tag-filter" class="tag-toggle" data-tag="RP">
                            <span class="slider rp-slider"></span>
                        </label>
                    </div>
                    <div class="filter">
                        <span>Delivery</span>
                        <label class="toggle">
                            <input type="radio" name="tag-filter" class="tag-toggle" data-tag="Delivery">
                            <span class="slider delivery-slider"></span>
                        </label>
                    </div>
                    <div class="filter">
                        <span>Terminado</span>
                        <label class="toggle">
                            <input type="radio" name="tag-filter" class="tag-toggle" data-tag="Terminado">
                            <span class="slider terminado-slider"></span>
                        </label>
                    </div>
                    <div class="filter">
                        <span>Servientrega</span>
                        <label class="toggle">
                            <input type="radio" name="tag-filter" class="tag-toggle" data-tag="Servientrega">
                            <span class="slider servientrega-slider"></span>
                        </label>
                    </div>
                    <div class="filter">
                        <span>Recibido</span>
                        <label class="toggle">
                            <input type="radio" name="tag-filter" class="tag-toggle" data-tag="Recibido">
                            <span class="slider recibido-slider"></span>
                        </label>
                    </div>
                    <div class="filter">
                        <span>Sin etiqueta</span>
                        <label class="toggle">
                            <input type="radio" name="tag-filter" class="tag-toggle" data-tag="default">
                            <span class="slider default-slider"></span>
                        </label>
                    </div>
                </div>
            </div>
            <button class="bot-config-button">
                            <i class="fas fa-robot"></i>
            </button>
        </div>

        <!-- Contenido principal -->
        <div class="main-content">

            <!-- Lista de contactos -->
            <div id="contacts-container">
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="search-input" placeholder="Buscar por nombre...">
                </div>
                <div class="contacts-list"></div>
            </div>

            <!-- Área de chat -->
            <div class="chat-area">
                <div class="chat-header">
                    <div class="chat-info-container">
                        <h2 class="chat-title"></h2>
                        <a href="#" target="_blank" class="post-link">post link</a>
                    </div>
                    <!-- Toggle encender/apagar bot -->
                    <div class="bot-toggle small">
                        <div class="tag-btn-container">
                            <button class="tag-btn tag-btn--contraentrega">Contraentrega</button>
                            <button class="tag-btn tag-btn--rp">RP</button>
                            <button class="tag-btn tag-btn--delivery">Delivery</button>
                            <button class="tag-btn tag-btn--terminado">Terminado</button>
                            <button class="tag-btn tag-btn--servientrega">Servientrega</button>
                            <button class="tag-btn tag-btn--recibido">Recibido</button>
                        </div>
                    </div>
                </div>

                <!-- Here all the messages appear -->
                <div class="messages"></div>

                <!-- input text to send manual messages -->

                <div class="chat-bottom">
                    <!-- Boton de respuestas rapidas -->
                    <button id="openQuickRepliesConfig">
                        <i class="fas fa-comment-dots"></i>
                    </button>
                    <!-- boton de modal del bot -->
                    <div class="bot-toggle-options">
                        <label class="toggle">
                            <input type="checkbox" checked class="individual-bot-toggle">
                            <span class="slider"></span>
                        </label>
                    </div>

                    <!-- Botón para mostrar/ocultar contactos en móvil -->
                    <button class="toggle-contacts">
                        <i class="fas fa-users"></i>
                    </button>

                    <!-- Input stuffs container -->
                    <div class="message-input-container">
                    <!-- Este nuevo contenedor mostrará las miniaturas en una cuadrícula -->
                        <div id="staged-images-grid" class="staged-images-grid"></div>
                        <!-- Wrapper for the main input row -->
                        <div class="input-wrapper">
                        <textarea class="message-input" placeholder="Escribir mensaje" rows="1"></textarea>
                        
                        <!-- El input de archivo ahora permite selección múltiple. Se elimina 'capture' para evitar conflictos en desktop. -->
                        <input type="file" id="image-file-input" accept="image/*" multiple style="display: none;">

                        <div class="attachment-container">
                            <button class="attach-button">
                                <i class="fas fa-paperclip"></i>
                            </button>
                        </div>
                        <button class="send-button">
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de configuración del bot -->
    <div class="bot-config-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Configuración General del Bot</h2>
                <button class="close-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="bot-modification">
                    <h3>Modificar bot:</h3>
                    <textarea id="bot-behavior" class="bot-textarea"></textarea>
                </div>
                <div class="bot-modification">
                    <h3>Modificar tabla de datos (JSON):</h3>
                    <textarea id="bot-table" class="bot-textarea"></textarea>
                </div>
                <div class="bot-modification">
                    <h3>Modificar prompt de comentarios:</h3>
                    <textarea id="bot-comments-prompt" class="bot-textarea"></textarea>
                </div>
                <div class="modal-token-container">
                    <div class="token-usage">
                        <p>Uso total de tokens: x</p>
                    </div>
                    <div class="modal-actions">
                        <button class="modal-button cancel-button">Cancelar</button>
                        <button class="modal-button save-button">Guardar cambios</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Respuestas Rápidas -->
    <div class="quick-replies-modal" id="quickRepliesModal">
        <div class="quick-replies-content">
            <div class="quick-replies-header">
                <h2>Respuestas Rápidas</h2>
                <button class="close-quick-replies" id="closeQuickReplies">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="quick-replies-list"></div>
            
            <button class="add-quick-reply-btn" id="openCreateQuickReply">
                <i class="fas fa-plus"></i> Crear nueva respuesta rápida
            </button>
        </div>
        <!-- Modal para crear nueva respuesta rápida -->
        <div class="create-quick-reply-modal" id="createQuickReplyModal">
            <div class="create-quick-reply-content">
                <h3>Nueva respuesta rápida</h3>
                
                <!-- Contenedor para previsualización de imágenes -->
                <div id="qr-staged-images-grid" class="staged-images-grid"></div>

                <!-- Wrapper para el input y el botón de adjuntar -->
                <div class="qr-input-wrapper">
                    <textarea class="quick-reply-textarea" placeholder="Escribe tu respuesta rápida aquí..."></textarea>
                    
                    <!-- Input de archivo oculto para las imágenes de QR -->
                    <input type="file" id="qr-image-file-input" accept="image/*" multiple style="display: none;">

                    <div class="attachment-container">
                        <button class="qr-attach-button">
                            <i class="fas fa-paperclip"></i>
                        </button>
                    </div>
                </div>

                <div class="create-quick-reply-actions">
                    <button class="cancel-create-quick-reply" id="cancelCreateQuickReply">Cancelar</button>
                    <button class="save-create-quick-reply">Crear</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Fin modal respuestas rápidas -->

    <!-- Modal de confirmación para eliminar -->
    <div class="delete-confirmation-modal" id="deleteConfirmationModal">
        <div class="delete-confirmation-content">
            <p id="deleteConfirmationText"></p>
            <div class="delete-confirmation-actions">
                <button id="cancelDeleteBtn">Cancelar</button>
                <button id="confirmDeleteBtn">Eliminar</button>
            </div>
        </div>
    </div>
    <!-- Fin modal respuestas rápidas -->

    <!-- Visor de Imágenes (Lightbox) -->
    <div id="image-lightbox" class="lightbox-overlay">
        <span class="lightbox-close">&times;</span>
        <img class="lightbox-content" id="lightbox-image">
    </div>

    <script>
        document.write(`
            <script type="module" src="${window.APP_CONFIG.pathSocket}/socket.io/socket.io.js"><\/script>
            <script type="module" src="${window.APP_CONFIG.basePath}/ui.js"><\/script>
            <script type="module" src="${window.APP_CONFIG.basePath}/script.js"><\/script>
        `);
    </script>
    <script src="https://cdn.jsdelivr.net/npm/heic2any@0.0.4/dist/heic2any.min.js"></script>
</body>
</html>